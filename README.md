# 匈汉象棋 (Hung-Han Chess)

一个基于PyGame的匈汉象棋游戏，支持双人对战和人机对战，拥有美观的界面和智能AI。


## 功能特色

- **双重游戏模式**: 双人对战或与AI对弈
- **高级AI难度**: 使用深度搜索和复杂评估函数的高级AI
- **完整规则实现**: 包括匈汉象棋特有棋子规则（尉、射、檑、甲等）
- **落子提示**: 高亮显示选中棋子所有可行的移动位置
- **移动轨迹**: 显示上一步移动的起点和终点
- **中文棋谱**: 使用传统中文棋谱记录走法（如"炮二平五"、"马8进7"等）
- **音效系统**: 移动、吃子和将军时的音效反馈
- **完整的UI**: 包括计时器、悔棋功能、全屏模式等
- **13x13棋盘**: 显示13x13的匈汉象棋棋盘和标识
- **MCTS AI支持**: 包含蒙特卡洛树搜索算法的AI实现
- **可配置设置**: 支持游戏参数调整和个性化设置

## 安装与运行

### 环境要求

- Python 3.6+
- PyGame 2.0+

### 安装步骤

1. 克隆或下载此仓库
   ```
   git clone https://github.com/yourusername/chinese-chess.git
   cd chinese-chess
   ```

2. 安装必要的依赖项
   ```
   pip install -r requirements.txt
   ```

3. 运行游戏
   ```
   python -m program.main
   ```

## 游戏玩法

### 控制方式

- **鼠标操作**: 点击棋子进行选择，点击目标位置进行移动
- **悔棋按钮**: 点击悔棋可以撤销上一步操作
- **返回按钮**: 返回到主菜单
- **全屏切换**: 点击全屏按钮或按F11/Alt+Enter切换全屏模式
- **设置选项**: 可调整游戏参数和AI设置

### 游戏流程

1. **开始界面**: 选择游戏模式（双人对战或人机对战）客户端模式初始化
连接服务器失败: [WinError 10061] 由于目标计算机积极拒绝，无法连接。
2. **阵营选择**: 如果选择人机对战，可选择执红方或黑方
3. **博弈过程**: 红方先行，双方轮流移动
4. **胜负判定**: 将军/将死、特殊规则（汉/汗进入敌方九宫）等

## 关键功能讲解

### 棋盘与棋子

- **棋盘设计**: 13×13格，带有河界
- **棋子造型**: 传统圆形象棋棋子，红黑双方
- **棋子种类**: 汉/汗(王)、仕(士)、相(象)、马、车、炮、兵(卒)、尉(衛)、射(䠶)、檑(礌)、甲(胄)

### AI系统

项目包含多种AI系统:

- **传统AI**: 使用Negamax算法、Alpha-Beta剪枝、历史启发和MVV-LVA启发的高级AI
- **MCTS AI**: 蒙特卡洛树搜索算法实现的AI

传统AI使用Negamax算法搭配Alpha-Beta剪枝优化，并引入历史启发和MVV-LVA启发。评估函数考虑了:
- 棋子价值
- 棋子位置
- 对中心的控制
- 行动力与机动性
- 将帅安全
- 棋子威胁与保护关系
- 特殊棋子能力（相在敌方区域的能力、尉的跳跃能力、檑的攻击能力等）
- 棋子协调性

MCTS AI使用蒙特卡洛树搜索算法，包括:
- 动作空间建模
- 策略网络和价值网络
- 模拟对局学习

### 悔棋系统

- **双人模式**: 可以悔棋一步
- **人机模式**: 悔棋会撤销玩家和AI的各一步

### 走法记录

- **可视化**: 绿色高亮显示棋子移动的起点和终点，并用线连接
- **棋谱记录**: 使用标准中文棋谱记录格式，如"炮二平五"

## 代码结构

```
program/
├── ai/                    # AI相关模块
│   ├── chess_ai.py        # 传统AI实现（Negamax算法）
│   └── mcts/              # MCTS AI相关模块
│       ├── mcts_config.py # MCTS配置参数
│       └── mcts_game.py   # MCTS游戏逻辑
├── config/                # 配置相关模块
│   ├── config.py          # 基础配置
│   └── settings.py        # 游戏设置界面
├── core/                  # 核心游戏逻辑
│   ├── chess_pieces.py    # 棋子类定义
│   ├── game_rules.py      # 游戏规则实现
│   └── game_state.py      # 游戏状态管理
├── sounds/                # 音效模块
│   ├── generate_sounds.py # 音效生成脚本
│   └── *.wav              # 音效文件
├── ui/                    # 用户界面模块
│   ├── avatar.py          # 头像相关
│   ├── button.py          # 按钮组件
│   ├── dialogs.py         # 对话框组件
│   └── menu_screens.py    # 菜单界面
├── utils/                 # 工具函数
│   └── utils.py           # 通用工具函数
├── build_exe.py           # 打包脚本
├── chess_board.py         # 棋盘渲染与交互
├── game.py                # 游戏主逻辑
├── main.py                # 主程序入口
└── xionghan_chess.spec    # PyInstaller配置文件
```

## 项目特点

### 模块化设计
- 代码结构清晰，按功能模块划分
- 核心逻辑与界面分离
- AI系统独立实现，支持多种算法

### 可扩展性
- 支持多种AI算法切换
- 配置化参数设置
- 易于添加新功能和规则

### 性能优化
- AI搜索算法优化（Alpha-Beta剪枝、历史启发等）
- 音效和图形资源管理
- 游戏状态高效表示

## 后续规划

- [ ] 联网对战功能
- [ ] 棋谱导入导出
- [ ] 更多AI难度级别
- [ ] 棋局复盘功能
- [ ] 自定义棋盘与棋子主题
- [ ] MCTS AI训练优化

## 致谢

游戏音效来自公开资源。感谢所有为中国象棋文化传播做出贡献的爱好者。

## 许可

本项目采用MIT许可证，详情请参考LICENSE文件。